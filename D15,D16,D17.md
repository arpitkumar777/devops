#### **Ansible:**



To create user

\# ansible all -m user -a 'name=sush uid=1100 home=/india shell=/bin/bash state=present'



ansible all -m user -a 'name=sush state=absent' (deletes the user | if state is present, then the user state exists)



To create packages:

\# ansible all -m yum -a 'name=httpd state=present'



To start the service (In controller)

\# ansible all -m systemd -a 'name=httpd state=started enabled=true'



\# ansible-doc -l

&nbsp;

to create a blank file on target server:

\# ansible all -m file -a 'dest=/tmp/sush.txt state=touch' 



To create a dir

\# ansible all -m file -a 'dest=/tmp/devops state=directory' -- devops is a directory



To copy:

\# ansible all -m copy -a 'src=/etc/fstab dest=/tmp' 



To write inside a file:

\# ansible all -m copy -a 'dest=/tmp/index.html content="I love devops"'



------------------------------------------------------------------------------------------------------------------------------------------------------------



##### **ANSIBLE PLAYBOOK: (Same like manifest file -- written in yaml)**



\# vim playbook.yaml

---

\- name: tasks

&nbsp; hosts: all

&nbsp; tasks:



&nbsp;   - name: Creating user

&nbsp;     user:

&nbsp;       name: sush

&nbsp;       uid: 1134

&nbsp;       home: /ltimindtree

&nbsp;       shell: /bin/bash



&nbsp;   - name: Install httpd

&nbsp;     dnf:

&nbsp;       name: httpd

&nbsp;       state: latest



&nbsp;   - name: Start and enable httpd service

&nbsp;     service:

&nbsp;       name: httpd

&nbsp;       state: started

&nbsp;       enabled: true



&nbsp;   - name: Install cifs-utils

&nbsp;     dnf:

&nbsp;       name: cifs-utils

&nbsp;       state: present



...



\# ansible-playbook playbook.yaml --syntax-check



To see the flow of the playbook without actually committing it to the target servers:

\# ansible-playbook playbook.yaml -C



\# ansible-playbook playbook.yaml (To run the playbook)



------------------------------------------------------------------------------------------------------------------------------------------------------------

##### **CUSTOM VARIABLES in ANSIBLE PLAYBOOK:**



---

\- name: configure apache with vars

&nbsp; hosts: all

&nbsp; vars:

&nbsp;  - web\_server: httpd

&nbsp;  - my\_service: httpd

&nbsp;  - destination: /var/www/html/index.html

&nbsp;  - my\_content: "I am learning devops"

&nbsp;  - my\_rule: http

&nbsp;  - my\_firewalld: firewalld

&nbsp;

&nbsp; tasks:

&nbsp;   - name: install apache

&nbsp;     dnf:

&nbsp;       name: "{{ web\_server }}"

&nbsp;       state: present

&nbsp;   - name: started apache service

&nbsp;     systemd: 

&nbsp;       name: "{{ my\_service }}"

&nbsp;       state: started

&nbsp;       enabled: true

&nbsp;   - name: create an index.html into that path

&nbsp;     copy:

&nbsp;       content: "{{ my\_content }}"

&nbsp;       dest: "{{ destination }}"

&nbsp;   - name: configure apache firewalld         

&nbsp;     dnf:

&nbsp;       name: "{{ my\_firewalld }}"

&nbsp;       state: present

&nbsp;   - name: started firewalld

&nbsp;     systemd:

&nbsp;       name: "{{ my\_firewalld }}" 

&nbsp;       state: started

&nbsp;       enabled: true

&nbsp;   - name: add http rule in firewalld

&nbsp;     firewalld:

&nbsp;       service: "{{ my\_rule }}"

&nbsp;       immediate: true

&nbsp;       permanent: true

&nbsp;       state: enabled

...



To fix the firewalld issue, install this module:

\# ansible-galaxy collection install ansible.posix



-----------------------------------------------------------



##### **To create an EC2 instance using ansible controller only:**



       **yum install awscli**

 **  33  yum install pip**

 **  34  pip install boto**

 **  35  pip install boto3**

 **  36  pip install botocore**

 **  39  ansible-galaxy collection install amazon.aws**

 **  40  vi creds.yaml  (Add your IAM credentials here)**

 **  41  aws configure**

 **  42  vi hosts** 



**( \[localhost]**

   **localhost )**



   

 **  43  vi ec2.yaml (paste the code from GIT )**

 **  45  ansible-playbook ec2.yaml --syntax-check**

 **  46  ansible-playbook ec2.yaml**

 **  49 ssh-keygen (The generated key must be pasted in the controllers authorized\_keys file)**

&nbsp;  50 **ansible-playbook ec2.yaml**  



------------------------------

\# to know about RAM status:

free -h



To know about CPU stats:

\# cat /proc/cpuinfo



-----------------------------------------



##### **To install Kubernetes:** 

(Please ensure that the target machine is Ubuntu)



\# add the target machine as a host

\#  93  vi k8s-master.yaml (Copy paste https://github.com/sanjayguruji/ansible-code/blob/9e1fbed4ea2181b681165de5ba813675245f97d2/k8s-master-pkg.yaml | Change the version to 32 and at the bottom, change the hosts to "all" )

&nbsp;  97  ansible-galaxy collection install community.general

&nbsp;  98  ansible-playbook k8s-master.yaml --syntax-check

